# 快速测试指南

## 测试目的
验证对话卡死问题是否已修复

## 测试前准备

1. **确保 API 配置正确**
   - 打开游戏设置
   - 检查 API 密钥和 URL 是否正确配置
   - 测试连接是否成功

2. **清空旧日志**（可选）
   - 找到 `JYACS console.txt` 文件
   - 删除或重命名旧日志
   - 这样可以更容易看到新的日志

## 测试步骤

### 第 1 步：启动对话

1. 启动游戏
2. 进入对话功能
3. 等待连接成功

**预期结果**：
- 看到 "连接成功" 提示
- 优里出现在屏幕上
- 可以输入消息

### 第 2 步：第一轮对话

1. 输入消息："你好"
2. 按回车发送
3. 等待 AI 响应
4. **点击屏幕继续**

**预期结果**：
- AI 正常响应
- 显示对话内容
- 点击后可以继续

### 第 3 步：第二轮对话（关键测试）

1. **观察是否出现输入框**
2. 如果出现输入框，输入消息："今天天气怎么样"
3. 按回车发送
4. 等待 AI 响应
5. 点击屏幕继续

**预期结果**：
- ✅ **成功**：输入框正常出现，可以输入消息
- ❌ **失败**：游戏卡死，无法输入

### 第 4 步：多轮对话测试

如果第 2 步成功，继续进行 3-5 轮对话：

1. 输入不同的消息
2. 每次都等待响应
3. 每次都点击屏幕继续
4. 观察是否有任何异常

**预期结果**：
- 所有对话都能正常进行
- 没有卡死或延迟
- 响应速度正常

### 第 5 步：查看日志

1. 找到 `JYACS console.txt` 文件
   - 通常在游戏根目录
2. 用文本编辑器打开
3. 查看最后 100-200 行

**查找以下内容**：

✅ **好的标志**：
```
[DEBUG] 外层循环 #1 开始
[DEBUG] 状态验证通过，准备获取用户输入
[DEBUG] 刷新交互状态...
[DEBUG] renpy.input() 已返回，用户输入: '你好'
[DEBUG] 内层循环已退出
[DEBUG] 一轮对话完成，开始状态重置
[DEBUG] 状态重置完成，准备下一轮对话
[DEBUG] 外层循环 #2 开始
```

❌ **坏的标志**：
```
[ERROR] 达到最大循环次数，强制退出
[WARNING] 验证失败：is_responding 应为 False 但为 True
[ERROR] 状态验证失败，连续 3 次尝试后仍无法修复
[ERROR] 内层循环达到最大迭代次数 50，强制退出
```

## 测试结果判断

### ✅ 修复成功

如果满足以下所有条件：
- 能够进行第二轮对话
- 能够连续进行 5 轮以上对话
- 日志中没有错误或警告
- 状态重置日志正常

**下一步**：
- 继续正常使用
- 可以进行更长时间的测试
- 如果发现其他问题，记录并报告

### ❌ 修复失败

如果出现以下任何情况：
- 第二轮对话时仍然卡死
- 日志中有错误或警告
- 状态验证失败

**下一步**：
1. 保存完整的日志文件
2. 记录卡死发生的确切步骤
3. 查看 `.kiro/AUTOPILOT_FIX_SUMMARY.md` 中的 "如果问题仍然存在" 部分
4. 尝试进一步的修复方案

## 常见问题

### Q1: 日志文件在哪里？

**A**: `JYACS console.txt` 通常在以下位置之一：
- 游戏根目录（与 `DDLC.exe` 同级）
- `game/` 目录下
- 用户文档目录

### Q2: 如何判断是否卡死？

**A**: 卡死的标志：
- 屏幕没有反应
- 无法点击或输入
- 游戏窗口显示 "未响应"
- 等待 30 秒以上仍无反应

### Q3: 如果第一轮对话就失败了怎么办？

**A**: 这可能是其他问题：
- 检查 API 配置是否正确
- 检查网络连接
- 查看日志中的错误信息
- 这不是本次修复要解决的问题

### Q4: 日志太长，看不懂怎么办？

**A**: 重点查看以下内容：
1. 搜索 `[ERROR]` - 查找错误
2. 搜索 `[WARNING]` - 查找警告
3. 搜索 `外层循环` - 查看循环次数
4. 搜索 `状态重置` - 查看状态是否正常重置
5. 查看最后 50 行 - 看看最后发生了什么

## 快速测试命令

如果你熟悉命令行，可以使用以下命令快速查看日志：

### Windows (PowerShell)
```powershell
# 查看最后 100 行
Get-Content "JYACS console.txt" -Tail 100

# 查找错误
Select-String -Path "JYACS console.txt" -Pattern "ERROR"

# 查找警告
Select-String -Path "JYACS console.txt" -Pattern "WARNING"

# 查找状态重置
Select-String -Path "JYACS console.txt" -Pattern "状态重置"
```

### Windows (CMD)
```cmd
# 查看最后 100 行
powershell -Command "Get-Content 'JYACS console.txt' -Tail 100"

# 查找错误
findstr /C:"ERROR" "JYACS console.txt"

# 查找警告
findstr /C:"WARNING" "JYACS console.txt"
```

## 测试报告模板

如果需要报告测试结果，可以使用以下模板：

```
## 测试结果

**测试日期**: [填写日期]
**测试时间**: [填写时间]

### 测试环境
- 操作系统: Windows [版本]
- Ren'Py 版本: [版本]
- Python 版本: 2.7

### 测试结果
- [ ] 第一轮对话成功
- [ ] 第二轮对话成功
- [ ] 多轮对话成功（共 ___ 轮）
- [ ] 日志无错误
- [ ] 日志无警告

### 问题描述
[如果有问题，详细描述]

### 日志摘要
[粘贴关键日志片段]

### 截图
[如果有，附上截图]
```

## 联系支持

如果测试失败或有疑问：
1. 查看 `.kiro/AUTOPILOT_FIX_SUMMARY.md`
2. 查看 `.kiro/CRITICAL_FIX_ANALYSIS.md`
3. 保存完整的日志文件
4. 记录详细的复现步骤

---

**祝测试顺利！** 🎉
