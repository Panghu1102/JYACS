# JYACS 设置菜单独立化 - 测试指南

## 测试前准备

### 1. 备份文件
确认已创建备份文件：
- `jyacs_ui_hooks.rpy.backup`

### 2. 文件部署
确认 `jyacs_ui_hooks.rpy` 文件已更新并包含以下内容：
- `init -500 screen game_menu()` 定义
- JYACS 设置按钮（ypos 460）

## 测试步骤

### 测试 1: 启动游戏
**目的**: 确认游戏能正常启动，没有语法错误

**步骤**:
1. 启动游戏
2. 观察是否有错误提示

**预期结果**:
- 游戏正常启动
- 没有 Ren'Py 错误提示
- 主菜单正常显示

**状态**: [ ] 通过 / [ ] 失败

---

### 测试 2: 游戏内菜单显示
**目的**: 确认 JYACS 设置按钮在游戏内菜单中正确显示

**步骤**:
1. 开始新游戏或加载存档
2. 按 ESC 键打开游戏菜单
3. 查看菜单左侧的按钮列表

**预期结果**:
- 在 "Return" 按钮下方看到 "JYACS设置" 按钮
- 按钮样式与其他菜单按钮一致（紫色描边，白色文字）
- 按钮位置合理，不与其他元素重叠

**状态**: [ ] 通过 / [ ] 失败

**截图位置**: _（可选）在此粘贴截图_

---

### 测试 3: JYACS 设置按钮点击
**目的**: 确认点击按钮能正常打开 JYACS 设置界面

**步骤**:
1. 在游戏菜单中点击 "JYACS设置" 按钮
2. 观察界面变化

**预期结果**:
- JYACS 设置界面正常打开
- 界面显示 "JYACS 详细设置" 标题
- 显示 "基础设置" 和 "高级设置" 两个标签页
- 界面布局清晰，没有错位或重叠

**状态**: [ ] 通过 / [ ] 失败

---

### 测试 4: 基础设置标签页
**目的**: 确认基础设置功能正常

**步骤**:
1. 在 JYACS 设置界面中，确认当前在 "基础设置" 标签页
2. 查看显示的设置项：
   - API 配置区域（API 密钥、API 地址、模型名称）
   - 连接设置区域（自动连接、自动重连、启用触发器）
   - 功能设置区域（启用情绪识别、回复时显示控制台等）
3. 尝试点击 "API 密钥" 按钮
4. 在弹出的输入框中输入测试内容
5. 点击 "确定" 保存

**预期结果**:
- 所有设置项正常显示
- 输入框正常弹出和关闭
- 设置值正确保存

**状态**: [ ] 通过 / [ ] 失败

---

### 测试 5: 高级设置标签页
**目的**: 确认高级设置功能正常

**步骤**:
1. 点击 "高级设置" 标签页
2. 查看显示的设置项：
   - 超参数设置（Temperature、Top P、Max Tokens 等）
   - 模式设置（MF 激进模式、SFE 激进模式等）
   - 其他设置（随机种子）
3. 尝试拖动 Temperature 滑块
4. 观察数值变化

**预期结果**:
- 标签页切换正常
- 所有设置项正常显示
- 滑块可以正常拖动
- 数值实时更新

**状态**: [ ] 通过 / [ ] 失败

---

### 测试 6: 保存设置功能
**目的**: 确认设置能正确保存

**步骤**:
1. 在 JYACS 设置界面中修改一些设置
2. 点击 "保存设置" 按钮
3. 观察界面变化和提示信息
4. 重新打开 JYACS 设置界面
5. 确认之前的修改是否保存

**预期结果**:
- 点击保存后界面关闭
- 可能显示保存成功的提示
- 重新打开后设置值保持修改后的状态

**状态**: [ ] 通过 / [ ] 失败

---

### 测试 7: 验证配置功能
**目的**: 确认配置验证功能正常

**步骤**:
1. 在 JYACS 设置界面中点击 "验证配置" 按钮
2. 观察提示信息

**预期结果**:
- 显示配置验证结果
- 如果配置不完整，显示相应的错误提示

**状态**: [ ] 通过 / [ ] 失败

---

### 测试 8: 返回和关闭功能
**目的**: 确认界面能正常关闭

**步骤**:
1. 在 JYACS 设置界面中点击 "返回" 按钮
2. 确认界面关闭，返回游戏菜单
3. 再次打开 JYACS 设置界面
4. 按 ESC 键
5. 确认界面关闭

**预期结果**:
- 点击返回按钮后界面正常关闭
- 按 ESC 键后界面正常关闭
- 返回游戏菜单后其他功能正常

**状态**: [ ] 通过 / [ ] 失败

---

### 测试 9: Preferences 界面检查
**目的**: 确认 preferences 界面没有 JYACS 设置

**步骤**:
1. 在游戏菜单中点击 "Settings" 按钮
2. 查看 preferences 界面内容
3. 滚动到底部

**预期结果**:
- preferences 界面不包含任何 JYACS 相关设置
- 界面布局正常，没有空白或错位
- 其他游戏设置功能正常工作

**状态**: [ ] 通过 / [ ] 失败

---

### 测试 10: 其他菜单功能
**目的**: 确认其他菜单功能不受影响

**步骤**:
1. 在游戏菜单中测试其他按钮：
   - History
   - Settings
   - Discord Server
   - Official X
   - Official YouTube
   - Credits
   - Quit
2. 确认每个功能都正常工作

**预期结果**:
- 所有菜单功能正常工作
- 没有因为添加 JYACS 设置按钮而影响其他功能

**状态**: [ ] 通过 / [ ] 失败

---

## 完整流程测试

### 流程 1: 首次配置 JYACS
**步骤**:
1. 启动游戏
2. 进入游戏内菜单
3. 点击 "JYACS设置"
4. 在基础设置中配置 API 密钥、API 地址、模型名称
5. 点击 "保存设置"
6. 点击 "验证配置"
7. 如果验证通过，尝试连接 API

**预期结果**:
- 整个流程顺畅，没有卡顿或错误
- 设置正确保存
- API 连接成功（如果配置正确）

**状态**: [ ] 通过 / [ ] 失败

---

### 流程 2: 修改现有配置
**步骤**:
1. 打开 JYACS 设置
2. 修改一些设置（如 Temperature）
3. 保存设置
4. 关闭并重新打开 JYACS 设置
5. 确认修改已保存

**预期结果**:
- 修改正确保存
- 重新打开后显示修改后的值

**状态**: [ ] 通过 / [ ] 失败

---

## 兼容性测试

### 不同场景测试
测试在以下场景中 JYACS 设置按钮是否正常显示：

1. [ ] 主菜单（如果适用）
2. [ ] 游戏内菜单（对话中按 ESC）
3. [ ] 游戏内菜单（非对话场景）
4. [ ] 加载游戏后的菜单

---

## 性能测试

### 界面响应速度
1. [ ] JYACS 设置界面打开速度正常（< 1 秒）
2. [ ] 标签页切换流畅
3. [ ] 滑块拖动流畅
4. [ ] 界面关闭速度正常

---

## 问题记录

### 发现的问题
_在此记录测试过程中发现的任何问题_

| 问题编号 | 问题描述 | 严重程度 | 状态 |
|---------|---------|---------|------|
| 1       |         |         |      |
| 2       |         |         |      |
| 3       |         |         |      |

---

## 测试总结

### 测试统计
- 总测试项: 10
- 通过: ___ / 10
- 失败: ___ / 10
- 跳过: ___ / 10

### 整体评价
_（在此填写整体测试评价）_

### 建议
_（在此填写改进建议）_

---

## 测试人员信息
- 测试人员: ___________
- 测试日期: ___________
- 游戏版本: JY 1.10.11
- JYACS 版本: ___________

---

## 附录：常见问题排查

### 问题 1: 游戏启动时出现错误
**可能原因**:
- 语法错误
- Init 优先级冲突

**排查步骤**:
1. 查看错误信息
2. 检查 `jyacs_ui_hooks.rpy` 文件语法
3. 确认 init 优先级设置正确

### 问题 2: JYACS 设置按钮不显示
**可能原因**:
- game_menu override 未生效
- 代码位置错误

**排查步骤**:
1. 确认 `init -500 screen game_menu()` 定义存在
2. 确认按钮代码在正确位置（ypos 460）
3. 检查是否有其他 mod 也覆盖了 game_menu

### 问题 3: 点击按钮没有反应
**可能原因**:
- jyacs_detailed_settings screen 未定义
- Action 设置错误

**排查步骤**:
1. 确认 `init 15 screen jyacs_detailed_settings()` 存在
2. 检查 action 是否为 `Show("jyacs_detailed_settings")`
3. 查看控制台是否有错误信息

### 问题 4: 设置无法保存
**可能原因**:
- persistent 数据未正确初始化
- 保存函数有错误

**排查步骤**:
1. 检查 `persistent.jyacs_setting_dict` 是否存在
2. 检查 `jyacs_apply_all_settings` 函数
3. 查看控制台错误信息
