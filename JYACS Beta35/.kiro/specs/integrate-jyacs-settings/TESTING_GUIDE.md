# JYACS 设置界面集成 - 测试指南

## 测试概述

本文档提供了完整的测试步骤，用于验证 JYACS 设置界面与 JY 1.10.11 的集成是否成功。

## 测试环境准备

### 1. 文件检查

确保以下文件存在且正确：

- ✅ `jyacs_ui_hooks.rpy` - 新创建的 UI 钩子文件
- ✅ `jyacs_settings.rpy` - 已重构的设置文件
- ✅ `jyacs_init.rpy` - 初始化文件
- ✅ `jyacs_api.rpy` - API 相关文件

### 2. 启动游戏

1. 启动 JY 1.10.11 游戏
2. 等待游戏完全加载
3. 检查控制台是否有错误信息

## 功能测试清单

### 测试 1: 访问设置界面

**步骤:**
1. 在游戏中按 `ESC` 键打开菜单
2. 点击 "Settings" 选项
3. 滚动到页面底部

**预期结果:**
- ✅ 能看到 "JYACS 设置" 区域
- ✅ 显示 API 状态和消息队列信息
- ✅ 有三个按钮: "连接"、"断开"、"详细设置"
- ✅ 视觉风格与 JY 原有设置一致（字体、颜色、布局）

**截图位置:** 主设置界面底部

---

### 测试 2: 验证 JY 原有设置功能

**步骤:**
1. 在设置界面中测试以下 JY 原有功能:
   - Display (Window/Fullscreen)
   - Skip (Unseen Text/After Choices)
   - Idle Frequency 滑块
   - Text Speed 滑块
   - Volume 滑块
   - Space BG Bloom 切换

**预期结果:**
- ✅ 所有 JY 原有设置功能正常工作
- ✅ 没有任何功能被破坏或覆盖
- ✅ 设置更改能正确保存和应用

---

### 测试 3: 快速操作按钮

**步骤:**
1. 点击 "连接" 按钮
2. 观察状态变化
3. 点击 "断开" 按钮
4. 观察状态变化

**预期结果:**
- ✅ 点击 "连接" 后显示 "正在连接 API..." 提示
- ✅ API 状态更新为 "已连接" 或 "连接中..."
- ✅ 点击 "断开" 后显示 "已断开连接" 提示
- ✅ API 状态更新为 "未连接"
- ✅ 如果 JYACS 未初始化，显示相应错误提示

---

### 测试 4: 打开详细设置界面

**步骤:**
1. 点击 "详细设置" 按钮

**预期结果:**
- ✅ 打开模态对话框
- ✅ 显示 "JYACS 详细设置" 标题
- ✅ 有两个标签页: "基础设置" 和 "高级设置"
- ✅ 默认显示 "基础设置" 标签页
- ✅ 背景有半透明遮罩
- ✅ 可以通过 ESC 键关闭

---

### 测试 5: 基础设置 - API 配置

**步骤:**
1. 在详细设置界面，确保在 "基础设置" 标签页
2. 点击 API 密钥的按钮
3. 在弹出的输入框中输入测试密钥
4. 点击 "确定"
5. 重复测试 API 地址和模型名称

**预期结果:**
- ✅ 点击后弹出文本输入对话框
- ✅ API 密钥显示为星号 (******)
- ✅ API 地址和模型名称显示实际文本
- ✅ 输入框支持复制粘贴
- ✅ 点击 "确定" 后值被保存
- ✅ 点击 "取消" 后值不变
- ✅ 可以通过 ESC 键关闭输入框

---

### 测试 6: 基础设置 - 连接和功能设置

**步骤:**
1. 测试所有复选框选项:
   - 自动连接
   - 自动重连
   - 启用触发器
   - 启用情绪识别
   - 回复时显示控制台
   - 启用 Mspire
   - 严格模式

**预期结果:**
- ✅ 点击复选框能正确切换选中/未选中状态
- ✅ 复选框使用 JY 的样式（带勾选图标）
- ✅ 状态变化立即反映在界面上

---

### 测试 7: 高级设置 - 超参数

**步骤:**
1. 切换到 "高级设置" 标签页
2. 测试所有滑块:
   - Temperature (0.0 - 2.0)
   - Top P (0.0 - 1.0)
   - Max Tokens (0 - 4096)
   - Frequency Penalty (0.0 - 2.0)
   - Presence Penalty (0.0 - 2.0)

**预期结果:**
- ✅ 滑块能正常拖动
- ✅ 实时显示当前值
- ✅ 值的格式正确（小数点后两位）
- ✅ 滑块样式与 JY 一致

---

### 测试 8: 高级设置 - 模式设置

**步骤:**
1. 测试所有模式开关:
   - MF 激进模式
   - SFE 激进模式
   - ESC 激进模式
   - NSFW 接受

**预期结果:**
- ✅ 开关能正确切换
- ✅ 状态正确保存

---

### 测试 9: 高级设置 - 随机种子

**步骤:**
1. 点击随机种子按钮
2. 输入一个整数（如 12345）
3. 点击 "确定"

**预期结果:**
- ✅ 弹出输入对话框
- ✅ 能输入整数
- ✅ 值被正确保存和显示

---

### 测试 10: 保存设置

**步骤:**
1. 修改一些设置项
2. 点击 "保存设置" 按钮
3. 关闭详细设置界面
4. 重新打开详细设置界面

**预期结果:**
- ✅ 点击保存后显示 "所有设置已保存" 提示
- ✅ 设置界面自动关闭
- ✅ 重新打开后设置值保持不变
- ✅ 如果必填字段为空，显示错误提示

---

### 测试 11: 验证配置

**步骤:**
1. 确保 API 密钥和地址已填写
2. 点击 "验证配置" 按钮
3. 等待验证完成

**预期结果:**
- ✅ 显示 "正在测试连接..." 提示
- ✅ 如果配置正确，显示 "验证成功: API 配置正确"
- ✅ 如果配置错误，显示具体错误信息
- ✅ 如果必填字段为空，显示相应提示

---

### 测试 12: 返回按钮

**步骤:**
1. 在详细设置界面点击 "返回" 按钮

**预期结果:**
- ✅ 详细设置界面关闭
- ✅ 返回到主设置界面
- ✅ 未保存的更改不会丢失（除非点击取消）

---

### 测试 13: 持久化测试

**步骤:**
1. 修改一些设置并保存
2. 完全退出游戏
3. 重新启动游戏
4. 打开设置界面查看

**预期结果:**
- ✅ 所有设置值在重启后保持不变
- ✅ API 状态正确恢复
- ✅ 如果设置了自动连接，游戏启动时自动连接

---

### 测试 14: 错误处理

**步骤:**
1. 尝试以下错误场景:
   - API 密钥为空时保存
   - API 地址为空时保存
   - API 地址格式错误时验证
   - 网络不可达时连接

**预期结果:**
- ✅ 每种错误都有清晰的提示信息
- ✅ 错误不会导致游戏崩溃
- ✅ 用户能理解错误原因并知道如何修复

---

## 视觉一致性测试

### 测试 15: 字体和颜色

**检查项:**
- ✅ 标签使用 RifficFree-Bold 字体
- ✅ 按钮使用 Halogen 字体
- ✅ 主色调为紫色 (#a679ff)
- ✅ 文本颜色为白色 (#ffffff)
- ✅ 悬停颜色为浅紫色 (#d5bdff)

### 测试 16: 布局和间距

**检查项:**
- ✅ JYACS 设置区域与 JY 原有设置对齐
- ✅ 元素间距与 JY 一致
- ✅ 按钮大小和形状与 JY 一致
- ✅ 滑块长度和样式与 JY 一致

### 测试 17: 响应式测试

**步骤:**
1. 测试不同窗口大小:
   - 全屏模式
   - 窗口模式（不同尺寸）

**预期结果:**
- ✅ 所有元素正确缩放
- ✅ 滚动条在需要时出现
- ✅ 文本不会溢出或被截断

---

## 兼容性测试

### 测试 18: 与 JY 功能的兼容性

**检查项:**
- ✅ 不影响 JY 的对话系统
- ✅ 不影响 JY 的表情系统
- ✅ 不影响 JY 的时间循环系统
- ✅ 不影响 JY 的保存/加载功能
- ✅ 不影响 JY 的其他 mod 功能

### 测试 19: 多语言支持

**步骤:**
1. 如果 JY 支持多语言，切换语言
2. 检查 JYACS 设置界面

**预期结果:**
- ✅ JYACS 设置文本正确显示（中文）
- ✅ 不影响 JY 的语言切换功能

---

## 性能测试

### 测试 20: 加载时间

**检查项:**
- ✅ 游戏启动时间没有明显增加
- ✅ 打开设置界面响应迅速
- ✅ 切换标签页流畅无卡顿
- ✅ 滑块拖动流畅

---

## 已知问题和限制

### 当前限制

1. **API 验证**: 验证功能需要 JYACS API 模块正确初始化
2. **连接状态**: 状态显示依赖于 `store.jyacs` 对象的存在
3. **字体文件**: 需要 JY 的字体文件存在于正确路径

### 待改进项

1. 添加更详细的错误日志
2. 优化验证配置的等待时间
3. 添加配置导入/导出功能
4. 添加配置预设功能

---

## 测试报告模板

### 测试信息

- **测试日期**: ___________
- **测试人员**: ___________
- **JY 版本**: 1.10.11
- **JYACS 版本**: 2.0.0

### 测试结果汇总

| 测试项 | 通过 | 失败 | 备注 |
|--------|------|------|------|
| 测试 1: 访问设置界面 | ☐ | ☐ | |
| 测试 2: JY 原有功能 | ☐ | ☐ | |
| 测试 3: 快速操作 | ☐ | ☐ | |
| 测试 4: 详细设置 | ☐ | ☐ | |
| 测试 5: API 配置 | ☐ | ☐ | |
| 测试 6: 连接设置 | ☐ | ☐ | |
| 测试 7: 超参数 | ☐ | ☐ | |
| 测试 8: 模式设置 | ☐ | ☐ | |
| 测试 9: 随机种子 | ☐ | ☐ | |
| 测试 10: 保存设置 | ☐ | ☐ | |
| 测试 11: 验证配置 | ☐ | ☐ | |
| 测试 12: 返回按钮 | ☐ | ☐ | |
| 测试 13: 持久化 | ☐ | ☐ | |
| 测试 14: 错误处理 | ☐ | ☐ | |
| 测试 15: 字体颜色 | ☐ | ☐ | |
| 测试 16: 布局间距 | ☐ | ☐ | |
| 测试 17: 响应式 | ☐ | ☐ | |
| 测试 18: 兼容性 | ☐ | ☐ | |
| 测试 19: 多语言 | ☐ | ☐ | |
| 测试 20: 性能 | ☐ | ☐ | |

### 发现的问题

1. ___________________________________________
2. ___________________________________________
3. ___________________________________________

### 总体评价

- [ ] 通过所有测试，可以发布
- [ ] 通过大部分测试，需要小修复
- [ ] 存在重大问题，需要大修复

---

## 快速测试步骤（5分钟版本）

如果时间有限，按以下步骤进行快速测试：

1. ✅ 启动游戏，按 ESC，进入 Settings
2. ✅ 滚动到底部，确认看到 JYACS 设置区域
3. ✅ 点击 "详细设置"，确认界面打开
4. ✅ 切换 "基础设置" 和 "高级设置" 标签页
5. ✅ 修改几个设置项，点击 "保存设置"
6. ✅ 重新打开详细设置，确认设置已保存
7. ✅ 测试一个 JY 原有功能（如音量滑块）
8. ✅ 退出游戏，重新启动，确认设置持久化

如果以上步骤都通过，基本功能正常。

---

## 联系和反馈

如果在测试过程中发现问题，请记录：
- 问题描述
- 重现步骤
- 预期行为
- 实际行为
- 截图（如果可能）
